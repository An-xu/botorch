<!DOCTYPE html><html lang=""><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>BoTorch · Bayesian Optimization in PyTorch</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Bayesian Optimization in PyTorch"/><meta property="og:title" content="BoTorch · Bayesian Optimization in PyTorch"/><meta property="og:type" content="website"/><meta property="og:url" content="https://botorch.org/"/><meta property="og:description" content="Bayesian Optimization in PyTorch"/><meta property="og:image" content="https://botorch.org/img/botorch.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://botorch.org/img/botorch.png"/><link rel="shortcut icon" href="/img/botorch.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-139570076-2', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code_block_buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/code_block_buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/mathjax.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/botorch_logo_lockup_white.png" alt="BoTorch"/><h2 class="headerTitleWithLogo">BoTorch</h2></a><a href="/versions"><h3>stable</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Docs</a></li><li class=""><a href="/tutorials/" target="_self">Tutorials</a></li><li class=""><a href="/api/" target="_self">API Reference</a></li><li class=""><a href="/docs/papers" target="_self">Papers</a></li><li class=""><a href="https://github.com/pytorch/botorch" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span></span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorials</h3><ul class=""><li class="navListItem"><a class="navItem" href="/tutorials/">Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Using BoTorch with Ax</h3><ul class=""><li class="navListItem"><a class="navItem" href="/tutorials/custom_botorch_model_in_ax">Using a custom BoTorch model</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/tutorials/custom_acquisition">Writing a custom acquisition function</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Full Optimization Loops</h3><ul class=""><li class="navListItem"><a class="navItem" href="/tutorials/closed_loop_botorch_only">q-Noisy Constrained EI</a></li><li class="navListItem"><a class="navItem" href="/tutorials/preference_bo">Bayesian optimization with pairwise comparison data</a></li><li class="navListItem"><a class="navItem" href="/tutorials/turbo_1">Trust Region Bayesian Optimization (TuRBO)</a></li><li class="navListItem"><a class="navItem" href="/tutorials/bo_with_warped_gp">Bayesian optimization with input warping</a></li><li class="navListItem"><a class="navItem" href="/tutorials/thompson_sampling">Bayesian optimization with large-scale Thompson sampling</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Multi-Objective Bayesian Optimization</h3><ul class=""><li class="navListItem"><a class="navItem" href="/tutorials/multi_objective_bo">Multi-objective optimization with qEHVI, qNEHVI, and qNParEGO</a></li><li class="navListItem"><a class="navItem" href="/tutorials/constrained_multi_objective_bo">Constrained multi-objective optimization with qNEHVI and qParEGO</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Bite-Sized Tutorials</h3><ul class=""><li class="navListItem"><a class="navItem" href="/tutorials/fit_model_with_torch_optimizer">Fitting a model using torch.optim</a></li><li class="navListItem"><a class="navItem" href="/tutorials/compare_mc_analytic_acquisition">Comparing analytic and MC Expected Improvement</a></li><li class="navListItem"><a class="navItem" href="/tutorials/optimize_with_cmaes">Acquisition function optimization with CMA-ES</a></li><li class="navListItem"><a class="navItem" href="/tutorials/optimize_stochastic">Acquisition function optimization with torch.optim</a></li><li class="navListItem"><a class="navItem" href="/tutorials/batch_mode_cross_validation">Using batch evaluation for fast cross-validation</a></li><li class="navListItem"><a class="navItem" href="/tutorials/one_shot_kg">The one-shot Knowledge Gradient acquisition function</a></li><li class="navListItem"><a class="navItem" href="/tutorials/max_value_entropy">The max-value entropy search acquisition function</a></li><li class="navListItem"><a class="navItem" href="/tutorials/GIBBON_for_efficient_batch_entropy_search">The GIBBON acquisition function for efficient batch entropy search</a></li><li class="navListItem"><a class="navItem" href="/tutorials/risk_averse_bo_with_environmental_variables">Risk averse Bayesian optimization with environmental variables</a></li><li class="navListItem"><a class="navItem" href="/tutorials/risk_averse_bo_with_input_perturbations">Risk averse Bayesian optimization with input perturbations</a></li><li class="navListItem"><a class="navItem" href="/tutorials/constraint_active_search">Constraint Active Search for Multiobjective Experimental Design</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced Usage</h3><ul class=""><li class="navListItem"><a class="navItem" href="/tutorials/meta_learning_with_rgpe">Meta-learning with RGPE</a></li><li class="navListItem"><a class="navItem" href="/tutorials/vae_mnist">High-dimensional optimization with VAEs</a></li><li class="navListItem"><a class="navItem" href="/tutorials/multi_fidelity_bo">Multi-fidelity Bayesian optimization using KG</a></li><li class="navListItem"><a class="navItem" href="/tutorials/discrete_multi_fidelity_bo">Multi-fidelity Bayesian optimization with discrete fidelities using KG</a></li><li class="navListItem"><a class="navItem" href="/tutorials/composite_bo_with_hogp">Composite Bayesian optimization with the High Order Gaussian Process</a></li><li class="navListItem"><a class="navItem" href="/tutorials/composite_mtbo">Composite Bayesian Optimization with Multi-Task Gaussian Processes</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="tutorialBody">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<div class="notebook">
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Writing-a-custom-acquisition-function-and-interfacing-with-Ax">Writing a custom acquisition function and interfacing with Ax<a class="anchor-link" href="#Writing-a-custom-acquisition-function-and-interfacing-with-Ax">¶</a></h2><p>As seen in the <a href="./custom_botorch_model_in_ax">custom BoTorch model in Ax</a> tutorial, Ax's <code>BotorchModel</code> is flexible in allowing different components of the Bayesian optimization loop to be specified through a functional API. This tutorial walks through the steps of writing a custom acquisition function and then inserting it into Ax.</p>
<p>Next cell sets up a decorator solely to speed up the testing of the notebook. You can safely ignore this cell and use of the decorator throughout the tutorial.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="kn">from</span> <span class="nn">ax.utils.testing.mock</span> <span class="kn">import</span> <span class="n">fast_botorch_optimize_context_manager</span>


<span class="n">SMOKE_TEST</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"SMOKE_TEST"</span><span class="p">)</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">dummy_context_manager</span><span class="p">():</span>
    <span class="k">yield</span>


<span class="k">if</span> <span class="n">SMOKE_TEST</span><span class="p">:</span>
    <span class="n">fast_smoke_test</span> <span class="o">=</span> <span class="n">fast_botorch_optimize_context_manager</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fast_smoke_test</span> <span class="o">=</span> <span class="n">dummy_context_manager</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Upper-Confidence-Bound-(UCB)">Upper Confidence Bound (UCB)<a class="anchor-link" href="#Upper-Confidence-Bound-(UCB)">¶</a></h3><p>The Upper Confidence Bound (UCB) acquisition function balances exploration and exploitation by assigning a score of $\mu + \sqrt{\beta} \cdot \sigma$ if the posterior distribution is normal with mean $\mu$ and variance $\sigma^2$. This "analytic" version is implemented in the <code>UpperConfidenceBound</code> class. The Monte Carlo version of UCB is implemented in the <code>qUpperConfidenceBound</code> class, which also allows for q-batches of size greater than one. (The derivation of q-UCB is given in Appendix A of <a href="https://arxiv.org/pdf/1712.00424.pdf">Wilson et. al., 2017</a>).</p>
<h3 id="A-scalarized-version-of-q-UCB">A scalarized version of q-UCB<a class="anchor-link" href="#A-scalarized-version-of-q-UCB">¶</a></h3><p>Suppose now that we are in a multi-output setting, where, e.g., we model the effects of a design on multiple metrics. We first show a simple extension of the q-UCB acquisition function that accepts a multi-output model and performs q-UCB on a scalarized version of the multiple outputs, achieved via a vector of weights. Implementing a new acquisition function in botorch is easy; one simply needs to implement the constructor and a <code>forward</code> method.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">botorch.acquisition.monte_carlo</span> <span class="kn">import</span> <span class="n">MCAcquisitionFunction</span>
<span class="kn">from</span> <span class="nn">botorch.models.model</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">botorch.sampling.samplers</span> <span class="kn">import</span> <span class="n">MCSampler</span><span class="p">,</span> <span class="n">SobolQMCNormalSampler</span>
<span class="kn">from</span> <span class="nn">botorch.utils</span> <span class="kn">import</span> <span class="n">t_batch_mode_transform</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">Tensor</span>


<span class="k">class</span> <span class="nc">qScalarizedUpperConfidenceBound</span><span class="p">(</span><span class="n">MCAcquisitionFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">beta</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">sampler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MCSampler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># we use the AcquisitionFunction constructor, since that of</span>
        <span class="c1"># MCAcquisitionFunction performs some validity checks that we don't want here</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MCAcquisitionFunction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sampler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sampler</span> <span class="o">=</span> <span class="n">SobolQMCNormalSampler</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">collapse_batch_dims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">sampler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">"beta"</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">"weights"</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>

    <span class="nd">@t_batch_mode_transform</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
        <span class="sd">"""Evaluate scalarized qUCB on the candidate set `X`.</span>

<span class="sd">        Args:</span>
<span class="sd">            X: A `(b) x q x d`-dim Tensor of `(b)` t-batches with `q` `d`-dim</span>
<span class="sd">                design points each.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tensor: A `(b)`-dim Tensor of Upper Confidence Bound values at the</span>
<span class="sd">                given design points `X`.</span>
<span class="sd">        """</span>
        <span class="n">posterior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">posterior</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="n">posterior</span><span class="p">)</span>  <span class="c1"># n x b x q x o</span>
        <span class="n">scalarized_samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>  <span class="c1"># n x b x q</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">mean</span>  <span class="c1"># b x q x o</span>
        <span class="n">scalarized_mean</span> <span class="o">=</span> <span class="n">mean</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>  <span class="c1"># b x q</span>
        <span class="n">ucb_samples</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">scalarized_mean</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">scalarized_samples</span> <span class="o">-</span> <span class="n">scalarized_mean</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ucb_samples</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that <code>qScalarizedUpperConfidenceBound</code> is very similar to <code>qUpperConfidenceBound</code> and only requires a few lines of new code to accomodate scalarization of multiple outputs. The <code>@t_batch_mode_transform</code> decorator ensures that the input <code>X</code> has an explicit t-batch dimension (code comments are added with shapes for clarity).</p>
<p>See the end of this tutorial for a quick and easy way of achieving the same scalarization effect using <code>ScalarizedPosteriorTransform</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Ad-hoc-testing-q-Scalarized-UCB">Ad-hoc testing q-Scalarized-UCB<a class="anchor-link" href="#Ad-hoc-testing-q-Scalarized-UCB">¶</a></h4><p>Before hooking the newly defined acquisition function into a Bayesian Optimization loop, we should test it. For this we'll just make sure that it properly evaluates on a compatible multi-output model. Here we just define a basic multi-output <code>SingleTaskGP</code> model trained on synthetic data.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">botorch.fit</span> <span class="kn">import</span> <span class="n">fit_gpytorch_model</span>
<span class="kn">from</span> <span class="nn">botorch.models</span> <span class="kn">import</span> <span class="n">SingleTaskGP</span>
<span class="kn">from</span> <span class="nn">botorch.utils</span> <span class="kn">import</span> <span class="n">standardize</span>
<span class="kn">from</span> <span class="nn">gpytorch.mlls</span> <span class="kn">import</span> <span class="n">ExactMarginalLogLikelihood</span>


<span class="c1"># generate synthetic data</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>  <span class="c1"># standardize to zero mean unit variance</span>

<span class="c1"># construct and fit the multi-output model</span>
<span class="k">with</span> <span class="n">fast_smoke_test</span><span class="p">():</span>
    <span class="n">gp</span> <span class="o">=</span> <span class="n">SingleTaskGP</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="n">mll</span> <span class="o">=</span> <span class="n">ExactMarginalLogLikelihood</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">gp</span><span class="p">)</span>
    <span class="n">fit_gpytorch_model</span><span class="p">(</span><span class="n">mll</span><span class="p">)</span>

<span class="c1"># construct the acquisition function</span>
<span class="n">qSUCB</span> <span class="o">=</span> <span class="n">qScalarizedUpperConfidenceBound</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># evaluate on single q-batch with q=3</span>
<span class="n">qSUCB</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[4]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>tensor([-0.0703], grad_fn=&lt;MeanBackward1&gt;)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># batch-evaluate on two q-batches with q=3</span>
<span class="n">qSUCB</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[5]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>tensor([0.3681, 0.3131], grad_fn=&lt;MeanBackward1&gt;)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-scalarized-version-of-analytic-UCB-(q=1-only)">A scalarized version of analytic UCB (<code>q=1</code> only)<a class="anchor-link" href="#A-scalarized-version-of-analytic-UCB-(q=1-only)">¶</a></h3><p>We can also write an <em>analytic</em> version of UCB for a multi-output model, assuming a multivariate normal posterior and <code>q=1</code>. The new class <code>ScalarizedUpperConfidenceBound</code> subclasses <code>AnalyticAcquisitionFunction</code> instead of <code>MCAcquisitionFunction</code>. In contrast to the MC version, instead of using the weights on the MC samples, we directly scalarize the mean vector $\mu$ and covariance matrix $\Sigma$ and apply standard UCB on the univariate normal distribution, which has mean $w^T \mu$ and variance $w^T \Sigma w$. In addition to the <code>@t_batch_transform</code> decorator, here we are also using <code>expected_q=1</code> to ensure the input <code>X</code> has a <code>q=1</code>.</p>
<p><em>Note:</em> BoTorch also provides a <code>ScalarizedObjective</code> abstraction that can be used with any existing analytic acqusition functions and automatically performs the scalarization we implement manually below. See the end of this tutorial for a usage example.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">botorch.acquisition</span> <span class="kn">import</span> <span class="n">AnalyticAcquisitionFunction</span>


<span class="k">class</span> <span class="nc">ScalarizedUpperConfidenceBound</span><span class="p">(</span><span class="n">AnalyticAcquisitionFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">beta</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">maximize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># we use the AcquisitionFunction constructor, since that of </span>
        <span class="c1"># AnalyticAcquisitionFunction performs some validity checks that we don't want here</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnalyticAcquisitionFunction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximize</span> <span class="o">=</span> <span class="n">maximize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">"beta"</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">"weights"</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>

    <span class="nd">@t_batch_mode_transform</span><span class="p">(</span><span class="n">expected_q</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
        <span class="sd">"""Evaluate the Upper Confidence Bound on the candidate set X using scalarization</span>

<span class="sd">        Args:</span>
<span class="sd">            X: A `(b) x d`-dim Tensor of `(b)` t-batches of `d`-dim design</span>
<span class="sd">                points each.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A `(b)`-dim Tensor of Upper Confidence Bound values at the given</span>
<span class="sd">                design points `X`.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">batch_shape</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">posterior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">posterior</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># b x o</span>
        <span class="n">scalarized_mean</span> <span class="o">=</span> <span class="n">means</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>  <span class="c1"># b</span>
        <span class="n">covs</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">mvn</span><span class="o">.</span><span class="n">covariance_matrix</span>  <span class="c1"># b x o x o</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 1 x o x 1 (assume single batch dimension)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">batch_shape</span> <span class="o">+</span> <span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>  <span class="c1"># b x o x 1</span>
        <span class="n">weights_transpose</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># b x 1 x o</span>
        <span class="n">scalarized_variance</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bmm</span><span class="p">(</span>
            <span class="n">weights_transpose</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">bmm</span><span class="p">(</span><span class="n">covs</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch_shape</span><span class="p">)</span>  <span class="c1"># b</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">expand_as</span><span class="p">(</span><span class="n">scalarized_mean</span><span class="p">)</span> <span class="o">*</span> <span class="n">scalarized_variance</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximize</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">scalarized_mean</span> <span class="o">+</span> <span class="n">delta</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">scalarized_mean</span> <span class="o">-</span> <span class="n">delta</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Ad-hoc-testing-Scalarized-UCB">Ad-hoc testing Scalarized-UCB<a class="anchor-link" href="#Ad-hoc-testing-Scalarized-UCB">¶</a></h4><p>Notice that we pass in an explicit q-batch dimension for consistency, even though <code>q=1</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># construct the acquisition function</span>
<span class="n">SUCB</span> <span class="o">=</span> <span class="n">ScalarizedUpperConfidenceBound</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># evaluate on single point</span>
<span class="n">SUCB</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[8]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>tensor([-1.2662], grad_fn=&lt;AddBackward0&gt;)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># batch-evaluate on 3 points</span>
<span class="n">SUCB</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[9]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>tensor([ 0.3431, -0.0833,  0.0702], grad_fn=&lt;AddBackward0&gt;)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Using-the-custom-acquisition-function-with-Ax's-Service-API">Using the custom acquisition function with Ax's Service API<a class="anchor-link" href="#Using-the-custom-acquisition-function-with-Ax's-Service-API">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Registering-the-new-acquisition-function">Registering the new acquisition function<a class="anchor-link" href="#Registering-the-new-acquisition-function">¶</a></h3><p>In order to use an acquisition function, Ax needs to know how to generate inputs to construct the acquisition function.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span>

<span class="kn">from</span> <span class="nn">botorch.acquisition.input_constructors</span> <span class="kn">import</span> <span class="n">acqf_input_constructor</span>


<span class="nd">@acqf_input_constructor</span><span class="p">(</span><span class="n">ScalarizedUpperConfidenceBound</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">construct_inputs_scalarized_ucb</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
    <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s2">"beta"</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">),</span>
        <span class="s2">"weights"</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">),</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Setting-up-a-GenerationStrategy-using-BOTORCH_MODULAR-with-our-custom-acquistion-function.">Setting up a <code>GenerationStrategy</code> using <code>BOTORCH_MODULAR</code> with our custom acquistion function.<a class="anchor-link" href="#Setting-up-a-GenerationStrategy-using-BOTORCH_MODULAR-with-our-custom-acquistion-function.">¶</a></h3><p><code>BOTORCH_MODULAR</code> is a convenient wrapper implemented in Ax that facilitates the use of custom BoTorch models and acquisition functions in Ax experiments. In order to customize the way the candidates are generated, we need to construct a new <code>GenerationStrategy</code> and pass it into the <code>AxClient</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">ax.modelbridge.generation_strategy</span> <span class="kn">import</span> <span class="n">GenerationStep</span><span class="p">,</span> <span class="n">GenerationStrategy</span>
<span class="kn">from</span> <span class="nn">ax.modelbridge.registry</span> <span class="kn">import</span> <span class="n">Models</span>


<span class="n">gs</span> <span class="o">=</span> <span class="n">GenerationStrategy</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># Quasi-random initialization step</span>
        <span class="n">GenerationStep</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">Models</span><span class="o">.</span><span class="n">SOBOL</span><span class="p">,</span>
            <span class="n">num_trials</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># How many trials should be produced from this generation step</span>
            <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">"seed"</span><span class="p">:</span> <span class="mi">999</span><span class="p">},</span>  <span class="c1"># Any kwargs you want passed into the model</span>
        <span class="p">),</span>
        <span class="c1"># Bayesian optimization step using the custom acquisition function</span>
        <span class="n">GenerationStep</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">Models</span><span class="o">.</span><span class="n">BOTORCH_MODULAR</span><span class="p">,</span>
            <span class="n">num_trials</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># No limitation on how many trials should be produced from this step</span>
            <span class="c1"># For `BOTORCH_MODULAR`, we pass in kwargs to specify what surrogate or acquisition function to use.</span>
            <span class="c1"># `acquisition_options` specifies the set of additional arguments to pass into the input constructor.</span>
            <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"botorch_acqf_class"</span><span class="p">:</span> <span class="n">ScalarizedUpperConfidenceBound</span><span class="p">,</span>
                <span class="s2">"acquisition_options"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"beta"</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">"weights"</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]},</span>
            <span class="p">},</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Setting-up-the-experiment">Setting up the experiment<a class="anchor-link" href="#Setting-up-the-experiment">¶</a></h3><p>We will set up a simple experiment to optimize a simple scalarization of the BraninCurrin function (per the weights above). A detailed tutorial on Service API can be found <a href="https://ax.dev/tutorials/gpei_hartmann_service.html">here</a>.</p>
<p>In order to use the <code>GenerationStrategy</code> we just created, we will pass it into the <code>AxClient</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">ax.service.ax_client</span> <span class="kn">import</span> <span class="n">AxClient</span>
<span class="kn">from</span> <span class="nn">ax.service.utils.instantiation</span> <span class="kn">import</span> <span class="n">ObjectiveProperties</span>
<span class="kn">from</span> <span class="nn">botorch.test_functions</span> <span class="kn">import</span> <span class="n">BraninCurrin</span>


<span class="c1"># Initialize the client - AxClient offers a convenient API to control the experiment</span>
<span class="n">ax_client</span> <span class="o">=</span> <span class="n">AxClient</span><span class="p">(</span><span class="n">generation_strategy</span><span class="o">=</span><span class="n">gs</span><span class="p">)</span>
<span class="c1"># Setup the experiment</span>
<span class="n">ax_client</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"branincurrin_test_experiment"</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"x</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"range"</span><span class="p">,</span>
            <span class="c1"># It is crucial to use floats for the bounds, i.e., 0.0 rather than 0.</span>
            <span class="c1"># Otherwise, the parameter would </span>
            <span class="s2">"bounds"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">objectives</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">"branin"</span><span class="p">:</span> <span class="n">ObjectiveProperties</span><span class="p">(</span><span class="n">minimize</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s2">"currin"</span><span class="p">:</span> <span class="n">ObjectiveProperties</span><span class="p">(</span><span class="n">minimize</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="c1"># Setup a function to evaluate the trials</span>
<span class="n">branincurrin</span> <span class="o">=</span> <span class="n">BraninCurrin</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"x</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]])</span>
    <span class="n">bc_eval</span> <span class="o">=</span> <span class="n">branincurrin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># In our case, standard error is 0, since we are computing a synthetic function.</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">"branin"</span><span class="p">:</span> <span class="p">(</span><span class="n">bc_eval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span> <span class="s2">"currin"</span><span class="p">:</span> <span class="p">(</span><span class="n">bc_eval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>[INFO 03-07 08:51:59] ax.service.ax_client: Starting optimization with verbose logging. To disable logging, set the `verbose_logging` argument to `False`. Note that float values in the logs are rounded to 6 decimal points.
[INFO 03-07 08:51:59] ax.service.utils.instantiation: Due to non-specification, we will use the heuristic for selecting objective thresholds.
[INFO 03-07 08:51:59] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter x1. If that is not the expected value type, you can explicity specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 03-07 08:51:59] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter x2. If that is not the expected value type, you can explicity specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 03-07 08:51:59] ax.service.utils.instantiation: Created search space: SearchSpace(parameters=[RangeParameter(name='x1', parameter_type=FLOAT, range=[0.0, 1.0]), RangeParameter(name='x2', parameter_type=FLOAT, range=[0.0, 1.0])], parameter_constraints=[]).
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Running-the-BO-loop">Running the BO loop<a class="anchor-link" href="#Running-the-BO-loop">¶</a></h3><p>Ax makes this part super simple!</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">fast_smoke_test</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
        <span class="n">parameters</span><span class="p">,</span> <span class="n">trial_index</span> <span class="o">=</span> <span class="n">ax_client</span><span class="o">.</span><span class="n">get_next_trial</span><span class="p">()</span>
        <span class="c1"># Local evaluation here can be replaced with deployment to external system.</span>
        <span class="n">ax_client</span><span class="o">.</span><span class="n">complete_trial</span><span class="p">(</span><span class="n">trial_index</span><span class="o">=</span><span class="n">trial_index</span><span class="p">,</span> <span class="n">raw_data</span><span class="o">=</span><span class="n">evaluate</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>[INFO 03-07 08:51:59] ax.service.ax_client: Generated new trial 0 with parameters {'x1': 0.62873, 'x2': 0.51481}.
[INFO 03-07 08:51:59] ax.service.ax_client: Completed trial 0 with data: {'branin': (46.244598, 0.0), 'currin': (6.842319, 0.0)}.
[INFO 03-07 08:51:59] ax.service.ax_client: Generated new trial 1 with parameters {'x1': 0.434883, 'x2': 0.396266}.
[INFO 03-07 08:51:59] ax.service.ax_client: Completed trial 1 with data: {'branin': (14.735401, 0.0), 'currin': (8.740173, 0.0)}.
[INFO 03-07 08:51:59] ax.service.ax_client: Generated new trial 2 with parameters {'x1': 0.075645, 'x2': 0.934926}.
[INFO 03-07 08:51:59] ax.service.ax_client: Completed trial 2 with data: {'branin': (2.808084, 0.0), 'currin': (4.10731, 0.0)}.
[INFO 03-07 08:51:59] ax.service.ax_client: Generated new trial 3 with parameters {'x1': 0.863245, 'x2': 0.038764}.
[INFO 03-07 08:51:59] ax.service.ax_client: Completed trial 3 with data: {'branin': (9.956846, 0.0), 'currin': (10.342199, 0.0)}.
[INFO 03-07 08:51:59] ax.service.ax_client: Generated new trial 4 with parameters {'x1': 0.953918, 'x2': 0.808236}.
[INFO 03-07 08:51:59] ax.service.ax_client: Completed trial 4 with data: {'branin': (95.420815, 0.0), 'currin': (4.715139, 0.0)}.
[INFO 03-07 08:52:00] ax.service.ax_client: Generated new trial 5 with parameters {'x1': 1.0, 'x2': 0.343958}.
[INFO 03-07 08:52:00] ax.service.ax_client: Completed trial 5 with data: {'branin': (6.59323, 0.0), 'currin': (7.800424, 0.0)}.
[INFO 03-07 08:52:00] ax.service.ax_client: Generated new trial 6 with parameters {'x1': 0.545884, 'x2': 0.0}.
[INFO 03-07 08:52:00] ax.service.ax_client: Completed trial 6 with data: {'branin': (5.420973, 0.0), 'currin': (11.428981, 0.0)}.
[INFO 03-07 08:52:00] ax.service.ax_client: Generated new trial 7 with parameters {'x1': 0.123583, 'x2': 0.0}.
[INFO 03-07 08:52:00] ax.service.ax_client: Completed trial 7 with data: {'branin': (151.348694, 0.0), 'currin': (12.425919, 0.0)}.
[INFO 03-07 08:52:00] ax.service.ax_client: Generated new trial 8 with parameters {'x1': 0.04517, 'x2': 0.0}.
[INFO 03-07 08:52:00] ax.service.ax_client: Completed trial 8 with data: {'branin': (240.225876, 0.0), 'currin': (7.476875, 0.0)}.
[INFO 03-07 08:52:01] ax.service.ax_client: Generated new trial 9 with parameters {'x1': 0.120646, 'x2': 0.032783}.
[INFO 03-07 08:52:01] ax.service.ax_client: Completed trial 9 with data: {'branin': (142.034271, 0.0), 'currin': (12.31697, 0.0)}.
[INFO 03-07 08:52:01] ax.service.ax_client: Generated new trial 10 with parameters {'x1': 0.111548, 'x2': 0.0}.
[INFO 03-07 08:52:01] ax.service.ax_client: Completed trial 10 with data: {'branin': (162.47403, 0.0), 'currin': (11.944614, 0.0)}.
[INFO 03-07 08:52:02] ax.service.ax_client: Generated new trial 11 with parameters {'x1': 0.129161, 'x2': 0.0}.
[INFO 03-07 08:52:02] ax.service.ax_client: Completed trial 11 with data: {'branin': (146.498032, 0.0), 'currin': (12.618309, 0.0)}.
[INFO 03-07 08:52:02] ax.service.ax_client: Generated new trial 12 with parameters {'x1': 0.133428, 'x2': 0.0}.
[INFO 03-07 08:52:02] ax.service.ax_client: Completed trial 12 with data: {'branin': (142.915176, 0.0), 'currin': (12.753123, 0.0)}.
[INFO 03-07 08:52:02] ax.service.ax_client: Generated new trial 13 with parameters {'x1': 0.128619, 'x2': 0.0}.
[INFO 03-07 08:52:02] ax.service.ax_client: Completed trial 13 with data: {'branin': (146.960831, 0.0), 'currin': (12.600433, 0.0)}.
[INFO 03-07 08:52:03] ax.service.ax_client: Generated new trial 14 with parameters {'x1': 0.126961, 'x2': 0.0}.
[INFO 03-07 08:52:03] ax.service.ax_client: Completed trial 14 with data: {'branin': (148.388519, 0.0), 'currin': (12.54465, 0.0)}.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Viewing-trials-and-plotting-the-Pareto-frontier">Viewing trials and plotting the Pareto frontier<a class="anchor-link" href="#Viewing-trials-and-plotting-the-Pareto-frontier">¶</a></h3><p>View the trials attached to the experiment.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">ax_client</span><span class="o">.</span><span class="n">generation_strategy</span><span class="o">.</span><span class="n">trials_as_df</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>[INFO 03-07 08:52:03] ax.modelbridge.generation_strategy: Note that parameter values in dataframe are rounded to 2 decimal points; the values in the dataframe are thus not the exact ones suggested by Ax in trials.
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[14]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Generation Step</th>
<th>Generation Model</th>
<th>Trial Index</th>
<th>Trial Status</th>
<th>Arm Parameterizations</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0</td>
<td>Sobol</td>
<td>0</td>
<td>COMPLETED</td>
<td>{'0_0': {'x1': 0.63, 'x2': 0.51}}</td>
</tr>
<tr>
<th>1</th>
<td>0</td>
<td>Sobol</td>
<td>1</td>
<td>COMPLETED</td>
<td>{'1_0': {'x1': 0.43, 'x2': 0.4}}</td>
</tr>
<tr>
<th>2</th>
<td>0</td>
<td>Sobol</td>
<td>2</td>
<td>COMPLETED</td>
<td>{'2_0': {'x1': 0.08, 'x2': 0.93}}</td>
</tr>
<tr>
<th>3</th>
<td>0</td>
<td>Sobol</td>
<td>3</td>
<td>COMPLETED</td>
<td>{'3_0': {'x1': 0.86, 'x2': 0.04}}</td>
</tr>
<tr>
<th>4</th>
<td>0</td>
<td>Sobol</td>
<td>4</td>
<td>COMPLETED</td>
<td>{'4_0': {'x1': 0.95, 'x2': 0.81}}</td>
</tr>
<tr>
<th>5</th>
<td>1</td>
<td>BoTorch</td>
<td>5</td>
<td>COMPLETED</td>
<td>{'5_0': {'x1': 1.0, 'x2': 0.34}}</td>
</tr>
<tr>
<th>6</th>
<td>1</td>
<td>BoTorch</td>
<td>6</td>
<td>COMPLETED</td>
<td>{'6_0': {'x1': 0.55, 'x2': 0.0}}</td>
</tr>
<tr>
<th>7</th>
<td>1</td>
<td>BoTorch</td>
<td>7</td>
<td>COMPLETED</td>
<td>{'7_0': {'x1': 0.12, 'x2': 0.0}}</td>
</tr>
<tr>
<th>8</th>
<td>1</td>
<td>BoTorch</td>
<td>8</td>
<td>COMPLETED</td>
<td>{'8_0': {'x1': 0.05, 'x2': 0.0}}</td>
</tr>
<tr>
<th>9</th>
<td>1</td>
<td>BoTorch</td>
<td>9</td>
<td>COMPLETED</td>
<td>{'9_0': {'x1': 0.12, 'x2': 0.03}}</td>
</tr>
<tr>
<th>10</th>
<td>1</td>
<td>BoTorch</td>
<td>10</td>
<td>COMPLETED</td>
<td>{'10_0': {'x1': 0.11, 'x2': 0.0}}</td>
</tr>
<tr>
<th>11</th>
<td>1</td>
<td>BoTorch</td>
<td>11</td>
<td>COMPLETED</td>
<td>{'11_0': {'x1': 0.13, 'x2': 0.0}}</td>
</tr>
<tr>
<th>12</th>
<td>1</td>
<td>BoTorch</td>
<td>12</td>
<td>COMPLETED</td>
<td>{'12_0': {'x1': 0.13, 'x2': 0.0}}</td>
</tr>
<tr>
<th>13</th>
<td>1</td>
<td>BoTorch</td>
<td>13</td>
<td>COMPLETED</td>
<td>{'13_0': {'x1': 0.13, 'x2': 0.0}}</td>
</tr>
<tr>
<th>14</th>
<td>1</td>
<td>BoTorch</td>
<td>14</td>
<td>COMPLETED</td>
<td>{'14_0': {'x1': 0.13, 'x2': 0.0}}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Plot the Pareto frontier.</p>
<p>Note that we do not expect a good coverage of the Pareto frontier since our acquisition function naively optimizes the sum of the two objectives.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">ax.plot.pareto_frontier</span> <span class="kn">import</span> <span class="n">plot_pareto_frontier</span>
<span class="kn">from</span> <span class="nn">ax.utils.notebook.plotting</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">ax.plot.pareto_utils</span> <span class="kn">import</span> <span class="n">compute_posterior_pareto_frontier</span>
<span class="n">objectives</span> <span class="o">=</span> <span class="n">ax_client</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">optimization_config</span><span class="o">.</span><span class="n">objective</span><span class="o">.</span><span class="n">objectives</span>
<span class="k">with</span> <span class="n">fast_smoke_test</span><span class="p">():</span>
    <span class="n">frontier</span> <span class="o">=</span> <span class="n">compute_posterior_pareto_frontier</span><span class="p">(</span>
        <span class="n">experiment</span><span class="o">=</span><span class="n">ax_client</span><span class="o">.</span><span class="n">experiment</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">ax_client</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">fetch_data</span><span class="p">(),</span>
        <span class="n">primary_objective</span><span class="o">=</span><span class="n">objectives</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span>
        <span class="n">secondary_objective</span><span class="o">=</span><span class="n">objectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span>
        <span class="n">absolute_metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">"branin"</span><span class="p">,</span> <span class="s2">"currin"</span><span class="p">],</span>
        <span class="n">num_points</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">render</span><span class="p">(</span><span class="n">plot_pareto_frontier</span><span class="p">(</span><span class="n">frontier</span><span class="p">,</span> <span class="n">CI_level</span><span class="o">=</span><span class="mf">0.90</span><span class="p">))</span> 
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_html rendered_html output_subarea">
<div> <div class="plotly-graph-div" id="e7710b14-3b74-4cc5-86d6-8afa7dd15961" style="height:500px; width:750px;"></div> <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("e7710b14-3b74-4cc5-86d6-8afa7dd15961")) {                    Plotly.newPlot(                        "e7710b14-3b74-4cc5-86d6-8afa7dd15961",                        [{"error_x": {"array": [2.1041476996943254, 6.786010259991971, 1.9656113401688824, 4.423732739414581, 0.053469934857209245, 2.78694105198828, 0.6898236525271969, 0.9382302172266984, 2.7732821025012337, 0.8286482293982549, 0.034751076827254826, 2.3476668361744735, 1.4979352627173559, 0.06967102340856428, 0.8953939354024776, 4.59889063486126, 3.3354967958939197, 3.6932123296624937, 4.221451769816604, 0.031238075792602585], "color": "rgba(128,177,211,0.4)", "thickness": 2, "type": "data"}, "error_y": {"array": [0.17873377264041637, 0.5515306718683937, 0.17253745258952607, 0.3751576343449705, 0.002915780693328641, 0.2410228815566845, 0.0644407066074909, 0.08878179657195737, 0.23989919395858042, 0.06689120025862685, 0.0014881697544525598, 0.1998204250555273, 0.13264795654518274, 0.0030433240864689635, 0.08444141407318506, 0.38959075548529154, 0.2842421343096247, 0.31436630497056933, 0.3584212826999636, 0.0013820652020805975], "color": "rgba(128,177,211,0.4)", "thickness": 2, "type": "data"}, "hoverinfo": "text", "legendgroup": "mean", "marker": {"color": "rgba(128,177,211,1)"}, "mode": "markers", "name": "mean", "text": ["<b>Parameterization 0</b><br>currin: 13.465 [13.287, 13.644]<br>branin: 117.584 [115.480, 119.688]<br><br><em>Parameterization:</em><br>x1: 0.16767920184322185<br>x2: 0.0", "<b>Parameterization 1</b><br>currin: 4.58 [4.028, 5.131]<br>branin: 291.107 [284.321, 297.893]<br><br><em>Parameterization:</em><br>x1: 0.0<br>x2: 0.0", "<b>Parameterization 2</b><br>currin: 6.184 [6.012, 6.357]<br>branin: 261.934 [259.969, 263.900]<br><br><em>Parameterization:</em><br>x1: 0.027194891362803644<br>x2: 2.5185166380839053e-16", "<b>Parameterization 3</b><br>currin: 13.6 [13.225, 13.975]<br>branin: 106.514 [102.091, 110.938]<br><br><em>Parameterization:</em><br>x1: 0.18536860966736218<br>x2: 3.3443785963432355e-18", "<b>Parameterization 4</b><br>currin: 12.077 [12.074, 12.080]<br>branin: 159.55 [159.496, 159.603]<br><br><em>Parameterization:</em><br>x1: 0.11460868316283454<br>x2: 5.3303323434787666e-17", "<b>Parameterization 5</b><br>currin: 5.816 [5.575, 6.057]<br>branin: 268.351 [265.564, 271.138]<br><br><em>Parameterization:</em><br>x1: 0.02160336746884051<br>x2: 0.0", "<b>Parameterization 6</b><br>currin: 8.372 [8.307, 8.436]<br>branin: 225.605 [224.915, 226.295]<br><br><em>Parameterization:</em><br>x1: 0.05683632434773296<br>x2: 4.918922233951485e-16", "<b>Parameterization 7</b><br>currin: 9.325 [9.236, 9.414]<br>branin: 210.035 [209.097, 210.973]<br><br><em>Parameterization:</em><br>x1: 0.06925532709748217<br>x2: 1.5503707099545582e-16", "<b>Parameterization 8</b><br>currin: 5.821 [5.581, 6.061]<br>branin: 268.252 [265.478, 271.025]<br><br><em>Parameterization:</em><br>x1: 0.021691376056676585<br>x2: 3.2051296233652496e-17", "<b>Parameterization 9</b><br>currin: 13.243 [13.177, 13.310]<br>branin: 127.566 [126.737, 128.395]<br><br><em>Parameterization:</em><br>x1: 0.15325527390673868<br>x2: 1.773379865989145e-17", "<b>Parameterization 10</b><br>currin: 12.673 [12.671, 12.674]<br>branin: 145.076 [145.041, 145.111]<br><br><em>Parameterization:</em><br>x1: 0.13084181053123273<br>x2: 2.962376806316503e-16", "<b>Parameterization 11</b><br>currin: 13.49 [13.290, 13.690]<br>branin: 116.153 [113.805, 118.500]<br><br><em>Parameterization:</em><br>x1: 0.16985994621981024<br>x2: 2.9632435661937766e-18", "<b>Parameterization 12</b><br>currin: 6.425 [6.293, 6.558]<br>branin: 257.798 [256.300, 259.296]<br><br><em>Parameterization:</em><br>x1: 0.030717753467459964<br>x2: 0.0", "<b>Parameterization 13</b><br>currin: 11.898 [11.895, 11.901]<br>branin: 163.491 [163.421, 163.561]<br><br><em>Parameterization:</em><br>x1: 0.11051194919717217<br>x2: 1.072738325674222e-17", "<b>Parameterization 14</b><br>currin: 8.957 [8.872, 9.041]<br>branin: 216.076 [215.180, 216.971]<br><br><em>Parameterization:</em><br>x1: 0.06441505706513105<br>x2: 1.5792301613815218e-16", "<b>Parameterization 15</b><br>currin: 13.604 [13.214, 13.994]<br>branin: 105.838 [101.239, 110.437]<br><br><em>Parameterization:</em><br>x1: 0.18651341392393878<br>x2: 9.650520914440527e-19", "<b>Parameterization 16</b><br>currin: 13.559 [13.275, 13.844]<br>branin: 111.117 [107.782, 114.453]<br><br><em>Parameterization:</em><br>x1: 0.17777816466095842<br>x2: 3.439734827962657e-18", "<b>Parameterization 17</b><br>currin: 13.576 [13.262, 13.890]<br>branin: 109.518 [105.824, 113.211]<br><br><em>Parameterization:</em><br>x1: 0.18037637368600104<br>x2: 1.496325793153615e-17", "<b>Parameterization 18</b><br>currin: 13.595 [13.236, 13.953]<br>branin: 107.315 [103.093, 111.536]<br><br><em>Parameterization:</em><br>x1: 0.18402322384256978<br>x2: 4.938866169707718e-18", "<b>Parameterization 19</b><br>currin: 12.641 [12.640, 12.642]<br>branin: 145.905 [145.874, 145.936]<br><br><em>Parameterization:</em><br>x1: 0.12986019184125364<br>x2: 4.2280177997753536e-19"], "type": "scatter", "x": [117.58389028667554, 291.1067937435533, 261.9341390131741, 106.51430497393156, 159.54982074893252, 268.35108348668814, 225.60472789080484, 210.03477458396634, 268.2515823601982, 127.5659257867915, 145.07590658746625, 116.15282771282256, 257.79795250639734, 163.49083168058758, 216.07584733390487, 105.83823160563985, 111.11717547592815, 109.51765586973892, 107.31479871719597, 145.90475360323035], "y": [13.46541893538193, 4.579630552641066, 6.184094471672527, 13.59992686397306, 12.07689179916785, 5.815591848370005, 8.371898089153662, 9.325132431371747, 5.821247624136068, 13.243409084309496, 12.672589873157278, 13.489805244845972, 6.425393170140941, 11.897802484570782, 8.956711548412214, 13.603935231589551, 13.559435420005158, 13.576081782633128, 13.59453002560557, 12.64105232536555]}],                        {"height": 500, "hovermode": "closest", "legend": {"orientation": "h"}, "margin": {"b": 75, "l": 225, "pad": 4, "t": 75}, "template": {"data": {"bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "bar"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "barpolar"}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "choropleth": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "choropleth"}], "contour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "contour"}], "contourcarpet": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "contourcarpet"}], "heatmap": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmap"}], "heatmapgl": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmapgl"}], "histogram": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "histogram"}], "histogram2d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2d"}], "histogram2dcontour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2dcontour"}], "mesh3d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "mesh3d"}], "parcoords": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "parcoords"}], "pie": [{"automargin": true, "type": "pie"}], "scatter": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter"}], "scatter3d": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter3d"}], "scattercarpet": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattercarpet"}], "scattergeo": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergeo"}], "scattergl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergl"}], "scattermapbox": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattermapbox"}], "scatterpolar": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolar"}], "scatterpolargl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolargl"}], "scatterternary": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterternary"}], "surface": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "surface"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}]}, "layout": {"annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "autotypenumbers": "strict", "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]], "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}, "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "geo": {"bgcolor": "white", "lakecolor": "white", "landcolor": "#E5ECF6", "showlakes": true, "showland": true, "subunitcolor": "white"}, "hoverlabel": {"align": "left"}, "hovermode": "closest", "mapbox": {"style": "light"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "ternary": {"aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "title": {"x": 0.05}, "xaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}, "yaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}}}, "title": {"text": "Pareto Frontier"}, "width": 750, "xaxis": {"ticksuffix": "", "title": {"text": "branin"}, "zeroline": true}, "yaxis": {"ticksuffix": "", "title": {"text": "currin"}, "zeroline": true}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('e7710b14-3b74-4cc5-86d6-8afa7dd15961');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script> </div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Appendix:-Using-ScalarizedPosteriorTransform">Appendix: Using <code>ScalarizedPosteriorTransform</code><a class="anchor-link" href="#Appendix:-Using-ScalarizedPosteriorTransform">¶</a></h3><p>Using the <code>ScalarizedPosteriorTransform</code> abstraction, the functionality of <code>ScalarizedUpperConfidenceBound</code> implemented above can be easily achieved in just a few lines of code. <code>PosteriorTransform</code>s can be used with both the MC and analytic acquisition functions.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">botorch.acquisition.objective</span> <span class="kn">import</span> <span class="n">ScalarizedPosteriorTransform</span>
<span class="kn">from</span> <span class="nn">botorch.acquisition.analytic</span> <span class="kn">import</span> <span class="n">UpperConfidenceBound</span>

<span class="n">pt</span> <span class="o">=</span> <span class="n">ScalarizedPosteriorTransform</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]))</span>
<span class="n">SUCB</span> <span class="o">=</span> <span class="n">UpperConfidenceBound</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">posterior_transform</span><span class="o">=</span><span class="n">pt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div></div><div class="tutorialButtonWrapper buttonWrapper"><a class="tutorialButton button" download="" href="/files/custom_acquisition.ipynb" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-download" class="svg-inline--fa fa-file-download fa-w-12" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm76.45 211.36l-96.42 95.7c-6.65 6.61-17.39 6.61-24.04 0l-96.42-95.7C73.42 337.29 80.54 320 94.82 320H160v-80c0-8.84 7.16-16 16-16h32c8.84 0 16 7.16 16 16v80h65.18c14.28 0 21.4 17.29 11.27 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"></path></svg>Download Tutorial Jupyter Notebook</a></div><div class="tutorialButtonWrapper buttonWrapper"><a class="tutorialButton button" download="" href="/files/custom_acquisition.py" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-download" class="svg-inline--fa fa-file-download fa-w-12" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm76.45 211.36l-96.42 95.7c-6.65 6.61-17.39 6.61-24.04 0l-96.42-95.7C73.42 337.29 80.54 320 94.82 320H160v-80c0-8.84 7.16-16 16-16h32c8.84 0 16 7.16 16 16v80h65.18c14.28 0 21.4 17.29 11.27 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"></path></svg>Download Tutorial Source Code</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/botorch.png" alt="BoTorch" width="66" height="58"/></a><div class="footerSection"><h5>Docs</h5><a href="/docs/introduction">Introduction</a><a href="/docs/getting_started">Getting Started</a><a href="/tutorials/">Tutorials</a><a href="/api/">API Reference</a><a href="https://arxiv.org/abs/1910.06403">Paper</a></div><div class="footerSection"><h5>Legal</h5><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noreferrer noopener">Privacy</a><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noreferrer noopener">Terms</a></div><div class="footerSection"><h5>Social</h5><div class="social"><a class="github-button" href="https://github.com/pytorch/botorch" data-count-href="https://github.com/pytorch/botorch/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star BoTorch on GitHub">botorch</a></div></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright"> Copyright © 2022 Meta Platforms Inc.</section><script>
            (function() {
              var BAD_BASE = '/botorch/';
              if (window.location.origin !== 'https://botorch.org') {
                var pathname = window.location.pathname;
                var newPathname = pathname.slice(pathname.indexOf(BAD_BASE) === 0 ? BAD_BASE.length : 1);
                var newLocation = 'https://botorch.org/' + newPathname;
                console.log('redirecting to ' + newLocation);
                window.location.href = newLocation;
              }
            })();
          </script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '207c27d819f967749142d8611de7cb19',
                indexName: 'botorch',
                inputSelector: '#search_input_react'
              });
            </script></body></html>